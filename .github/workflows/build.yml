name: Build LetRecovery Windows

on:
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
      
    - name: 安装构建工具
      uses: dtolnay/rust-toolchain@stable
      with:
        toolchain: stable
        targets: x86_64-pc-windows-msvc
        
    - name: 构建正常系统端
      run: |
        cd "正常系统端"
        cargo build --release
        
    - name: 构建PE端
      run: |
        cd "PE端"
        cargo build --release
        
    - name: 压缩正常系统端
      run: |
        mkdir -p 正常系统端-release
        copy "正常系统端\target\release\*.exe" 正常系统端-release\
        Compress-Archive -Path 正常系统端-release -DestinationPath 正常系统端.zip
        
    - name: 压缩PE端
      run: |
        mkdir -p PE端-release
        copy "PE端\target\release\*.exe" PE端-release\
        Compress-Archive -Path PE端-release -DestinationPath PE端.zip
        
    - name: 上传构建产物
      uses: actions/upload-artifact@v4
      with:
        name: letrecovery-windows-builds
        path: |
          正常系统端.zip
          PE端.zip
        retention-days: 30